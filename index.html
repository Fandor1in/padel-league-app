<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Padel League Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            color-scheme: light dark;
            --tg-bg: var(--tg-theme-bg-color, #ffffff);
            --tg-text: var(--tg-theme-text-color, #111111);
            --tg-hint: var(--tg-theme-hint-color, #707579);
            --tg-link: var(--tg-theme-link-color, #2a7bcf);
            --tg-button: var(--tg-theme-button-color, #2a7bcf);
            --tg-button-text: var(--tg-theme-button-text-color, #ffffff);
            --tg-secondary-bg: var(--tg-theme-secondary-bg-color, #f3f4f6);
            --tg-border: rgba(0, 0, 0, 0.1);
            --radius-card: 14px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--tg-bg);
            color: var(--tg-text);
            min-height: 100vh;
        }

        .app {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .header {
            padding: 16px;
            border-bottom: 1px solid var(--tg-border);
            background: var(--tg-secondary-bg);
        }

        .header-title {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .header-subtitle {
            margin-top: 4px;
            font-size: 13px;
            color: var(--tg-hint);
        }

        .nav {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            padding: 12px;
            border-bottom: 1px solid var(--tg-border);
        }

        .nav button {
            background: transparent;
            border: 1px solid var(--tg-border);
            border-radius: 12px;
            padding: 10px 6px;
            font-size: 12px;
            font-weight: 600;
            color: var(--tg-text);
        }

        .nav button.active {
            background: var(--tg-button);
            color: var(--tg-button-text);
            border-color: transparent;
        }

        main {
            flex: 1;
            padding: 16px;
        }

        .section {
            display: none;
            flex-direction: column;
            gap: 12px;
        }

        .section.active { display: flex; }

        .card {
            background: var(--tg-secondary-bg);
            border-radius: var(--radius-card);
            padding: 16px;
            border: 1px solid var(--tg-border);
        }

        .card h2 {
            font-size: 16px;
            margin-bottom: 8px;
        }

        .text-muted {
            color: var(--tg-hint);
            font-size: 13px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group label {
            font-size: 13px;
            color: var(--tg-hint);
        }

        .form-group input,
        .form-group select {
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid var(--tg-border);
            background: var(--tg-bg);
            color: var(--tg-text);
            font-size: 14px;
        }

        .row {
            display: grid;
            gap: 8px;
        }

        .row.two { grid-template-columns: 1fr 1fr; }
        .row.three { grid-template-columns: repeat(3, 1fr); }

        .button {
            border: none;
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 600;
            background: var(--tg-button);
            color: var(--tg-button-text);
        }

        .button.secondary {
            background: transparent;
            color: var(--tg-text);
            border: 1px solid var(--tg-border);
        }

        .tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 12px;
            background: rgba(42, 123, 207, 0.12);
            color: var(--tg-link);
        }

        .error {
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid rgba(255, 99, 99, 0.6);
            background: rgba(255, 99, 99, 0.12);
            color: #ff6363;
            font-size: 13px;
        }

        .list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .list-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .list-item span {
            font-size: 14px;
        }

        @media (max-width: 480px) {
            .nav { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="app">
        <header class="header">
            <div class="header-title">
                <span>ðŸŽ¾ Padel League</span>
                <select id="languageSelect" aria-label="Language">
                    <option value="uk">UA</option>
                    <option value="en">EN</option>
                </select>
            </div>
            <div class="header-subtitle" id="userInfo">...</div>
        </header>

        <nav class="nav">
            <button data-section="profile" class="active" data-i18n="nav.profile"></button>
            <button data-section="myPairs" data-i18n="nav.myPairs"></button>
            <button data-section="createPair" data-i18n="nav.createPair"></button>
            <button data-section="addMatch" data-i18n="nav.addMatch"></button>
            <button data-section="players" data-i18n="nav.players"></button>
            <button data-section="pairs" data-i18n="nav.pairs"></button>
        </nav>

        <main>
            <section id="profile" class="section active">
                <div class="card">
                    <h2 data-i18n="profile.title"></h2>
                    <p class="text-muted" data-i18n="profile.subtitle"></p>
                </div>
                <div class="card">
                    <div class="list">
                        <div class="list-item">
                            <span data-i18n="profile.rating"></span>
                            <span class="tag" id="profileRating">1200</span>
                        </div>
                        <div class="list-item">
                            <span data-i18n="profile.winRate"></span>
                            <span class="tag" id="profileWinRate">0%</span>
                        </div>
                        <div class="list-item">
                            <span data-i18n="profile.matches"></span>
                            <span id="profileMatches">0</span>
                        </div>
                    </div>
                </div>
            </section>

            <section id="myPairs" class="section">
                <div class="card">
                    <h2 data-i18n="myPairs.title"></h2>
                    <p class="text-muted" data-i18n="myPairs.subtitle"></p>
                </div>
                <div class="card list" id="myPairsList">
                    <div class="list-item">
                        <span>â€”</span>
                        <button class="button secondary" data-i18n="myPairs.remove"></button>
                    </div>
                </div>
            </section>

            <section id="createPair" class="section">
                <div class="card">
                    <h2 data-i18n="createPair.title"></h2>
                    <p class="text-muted" data-i18n="createPair.subtitle"></p>
                </div>
                <div class="card">
                    <div class="form-group">
                        <label data-i18n="createPair.playerA"></label>
                        <input id="pairPlayerA" type="text" placeholder="@username" />
                    </div>
                    <div class="form-group">
                        <label data-i18n="createPair.playerB"></label>
                        <input id="pairPlayerB" type="text" placeholder="@username" />
                    </div>
                    <button class="button" id="createPairBtn" data-i18n="createPair.submit"></button>
                </div>
            </section>

            <section id="addMatch" class="section">
                <div class="card">
                    <h2 data-i18n="addMatch.title"></h2>
                    <p class="text-muted" data-i18n="addMatch.subtitle"></p>
                </div>
                <div class="card">
                    <div class="form-group">
                        <label data-i18n="addMatch.teamA"></label>
                        <input id="matchTeamA" type="text" placeholder="Pair A" />
                    </div>
                    <div class="form-group">
                        <label data-i18n="addMatch.teamB"></label>
                        <input id="matchTeamB" type="text" placeholder="Pair B" />
                    </div>
                    <div class="form-group">
                        <label data-i18n="addMatch.sets"></label>
                        <div class="row three">
                            <input class="set-score" data-set="1" data-team="A" type="number" min="0" max="7" placeholder="6" />
                            <input class="set-score" data-set="1" data-team="B" type="number" min="0" max="7" placeholder="4" />
                            <span class="text-muted" data-i18n="addMatch.set1"></span>
                        </div>
                        <div class="row three" style="margin-top:8px;">
                            <input class="set-score" data-set="2" data-team="A" type="number" min="0" max="7" placeholder="7" />
                            <input class="set-score" data-set="2" data-team="B" type="number" min="0" max="7" placeholder="5" />
                            <span class="text-muted" data-i18n="addMatch.set2"></span>
                        </div>
                        <div class="row three" style="margin-top:8px;">
                            <input class="set-score" data-set="3" data-team="A" type="number" min="0" max="7" placeholder="" />
                            <input class="set-score" data-set="3" data-team="B" type="number" min="0" max="7" placeholder="" />
                            <span class="text-muted" data-i18n="addMatch.set3"></span>
                        </div>
                    </div>
                    <div id="matchError" class="error" style="display:none;"></div>
                    <button class="button" id="submitMatchBtn" data-i18n="addMatch.submit"></button>
                </div>
            </section>

            <section id="players" class="section">
                <div class="card">
                    <h2 data-i18n="players.title"></h2>
                    <p class="text-muted" data-i18n="players.subtitle"></p>
                </div>
                <div class="card list" id="playersList">
                    <div class="list-item">
                        <span>1. Alex D.</span>
                        <span class="tag">1200</span>
                    </div>
                </div>
            </section>

            <section id="pairs" class="section">
                <div class="card">
                    <h2 data-i18n="pairs.title"></h2>
                    <p class="text-muted" data-i18n="pairs.subtitle"></p>
                </div>
                <div class="card list" id="pairsList">
                    <div class="list-item">
                        <span>1. Alex D. & Maria L.</span>
                        <span class="tag">1180</span>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
        if (tg && typeof tg.ready === 'function') tg.ready();

        const translations = {
            uk: {
                'nav.profile': 'ÐœÑ–Ð¹ Ð¿Ñ€Ð¾Ñ„Ñ–Ð»ÑŒ',
                'nav.myPairs': 'ÐœÐ¾Ñ— Ð¿Ð°Ñ€Ð¸',
                'nav.createPair': 'Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ Ð¿Ð°Ñ€Ñƒ',
                'nav.addMatch': 'Ð”Ð¾Ð´Ð°Ñ‚Ð¸ Ð¼Ð°Ñ‚Ñ‡',
                'nav.players': 'Ð ÐµÐ¹Ñ‚Ð¸Ð½Ð³ Ð³Ñ€Ð°Ð²Ñ†Ñ–Ð²',
                'nav.pairs': 'Ð ÐµÐ¹Ñ‚Ð¸Ð½Ð³ Ð¿Ð°Ñ€',
                'profile.title': 'Ð’Ð°Ñˆ Ð¿Ñ€Ð¾Ñ„Ñ–Ð»ÑŒ',
                'profile.subtitle': 'Ð†Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ Ð· Telegram Ð±ÑƒÐ´Ðµ Ð¿Ñ–Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¶ÐµÐ½Ð° Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ñ– Ñ‡ÐµÑ€ÐµÐ· initData.',
                'profile.rating': 'Ð†Ð½Ð´Ð¸Ð²Ñ–Ð´ÑƒÐ°Ð»ÑŒÐ½Ð¸Ð¹ Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³',
                'profile.winRate': 'Ð’Ñ–Ð´ÑÐ¾Ñ‚Ð¾Ðº Ð¿ÐµÑ€ÐµÐ¼Ð¾Ð³',
                'profile.matches': 'ÐœÐ°Ñ‚Ñ‡Ñ–Ð² Ð·Ñ–Ð³Ñ€Ð°Ð½Ð¾',
                'myPairs.title': 'ÐœÐ¾Ñ— Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ– Ð¿Ð°Ñ€Ð¸',
                'myPairs.subtitle': 'ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÑÐ¹Ñ‚Ðµ Ð¿Ð°Ñ€Ñ‚Ð½ÐµÑ€Ñ–Ð² Ñ‚Ð° ÑˆÐ²Ð¸Ð´ÐºÐ¾ Ð²Ð¸Ð´Ð°Ð»ÑÐ¹Ñ‚Ðµ Ð·Ð°Ð¹Ð²Ñ– Ð¿Ð°Ñ€Ð¸.',
                'myPairs.remove': 'Ð’Ð¸Ð´Ð°Ð»Ð¸Ñ‚Ð¸',
                'createPair.title': 'Ð¡Ñ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ Ð½Ð¾Ð²Ñƒ Ð¿Ð°Ñ€Ñƒ',
                'createPair.subtitle': 'Ð‘Ð¾Ñ‚ Ð¿ÐµÑ€ÐµÐ²Ñ–Ñ€Ð¸Ñ‚ÑŒ, Ñ‡Ð¸ Ð¿Ð°Ñ€Ð° Ñ‰Ðµ Ð½Ðµ ÑÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð°, Ñ– Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð¸Ñ‚ÑŒ Ð¾Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ–Ð².',
                'createPair.playerA': 'Ð“Ñ€Ð°Ð²ÐµÑ†ÑŒ A',
                'createPair.playerB': 'Ð“Ñ€Ð°Ð²ÐµÑ†ÑŒ B',
                'createPair.submit': 'ÐÐ°Ð´Ñ–ÑÐ»Ð°Ñ‚Ð¸ Ð·Ð°Ð¿Ð¸Ñ‚',
                'addMatch.title': 'Ð”Ð¾Ð´Ð°Ñ‚Ð¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¼Ð°Ñ‚Ñ‡Ñƒ',
                'addMatch.subtitle': 'Ð’ÐºÐ°Ð¶Ñ–Ñ‚ÑŒ Ñ€Ð°Ñ…ÑƒÐ½Ð¾Ðº Ð¿Ð¾ ÑÐµÑ‚Ð°Ñ…. Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ– Ð»Ð¸ÑˆÐµ ÐºÐ¾Ñ€ÐµÐºÑ‚Ð½Ñ– Ð¿Ð°Ð´ÐµÐ»ÑŒ-Ñ€Ð°Ñ…ÑƒÐ½ÐºÐ¸.',
                'addMatch.teamA': 'ÐŸÐ°Ñ€Ð° A',
                'addMatch.teamB': 'ÐŸÐ°Ñ€Ð° B',
                'addMatch.sets': 'Ð Ð°Ñ…ÑƒÐ½Ð¾Ðº Ð¿Ð¾ ÑÐµÑ‚Ð°Ñ…',
                'addMatch.set1': 'Ð¡ÐµÑ‚ 1',
                'addMatch.set2': 'Ð¡ÐµÑ‚ 2',
                'addMatch.set3': 'Ð¡ÐµÑ‚ 3',
                'addMatch.submit': 'ÐÐ°Ð´Ñ–ÑÐ»Ð°Ñ‚Ð¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚',
                'players.title': 'Ð ÐµÐ¹Ñ‚Ð¸Ð½Ð³ Ð³Ñ€Ð°Ð²Ñ†Ñ–Ð²',
                'players.subtitle': 'ÐŸÑ–Ð´Ñ€Ð°Ñ…ÑƒÐ½Ð¾Ðº Ð·Ð° Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ð¾ÑŽ Wins*3 + Draws*1.',
                'pairs.title': 'Ð ÐµÐ¹Ñ‚Ð¸Ð½Ð³ Ð¿Ð°Ñ€',
                'pairs.subtitle': 'ÐšÐ¾Ð¼Ð°Ð½Ð´Ð½Ð¸Ð¹ Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³ Ð´Ð»Ñ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¸Ñ… Ð¿Ð°Ñ€.'
            },
            en: {
                'nav.profile': 'My Profile',
                'nav.myPairs': 'My Pairs',
                'nav.createPair': 'Create Pair',
                'nav.addMatch': 'Add Match',
                'nav.players': 'Players ranking',
                'nav.pairs': 'Pairs ranking',
                'profile.title': 'Your profile',
                'profile.subtitle': 'Telegram initData will be verified on the server.',
                'profile.rating': 'Individual rating',
                'profile.winRate': 'Win rate',
                'profile.matches': 'Matches played',
                'myPairs.title': 'My active pairs',
                'myPairs.subtitle': 'Manage your current partners.',
                'myPairs.remove': 'Remove',
                'createPair.title': 'Create a new pair',
                'createPair.subtitle': 'The bot validates duplicates and notifies opponents.',
                'createPair.playerA': 'Player A',
                'createPair.playerB': 'Player B',
                'createPair.submit': 'Send request',
                'addMatch.title': 'Submit match result',
                'addMatch.subtitle': 'Enter set scores (padel rules only).',
                'addMatch.teamA': 'Pair A',
                'addMatch.teamB': 'Pair B',
                'addMatch.sets': 'Set scores',
                'addMatch.set1': 'Set 1',
                'addMatch.set2': 'Set 2',
                'addMatch.set3': 'Set 3',
                'addMatch.submit': 'Send result',
                'players.title': 'Players ranking',
                'players.subtitle': 'Points = Wins*3 + Draws*1.',
                'pairs.title': 'Pairs ranking',
                'pairs.subtitle': 'Team ranking for active pairs.'
            }
        };

        const languageSelect = document.getElementById('languageSelect');
        const storedLang = localStorage.getItem('padel-lang');
        const defaultLang = storedLang || ((navigator.language || '').toLowerCase().startsWith('en') ? 'en' : 'uk');
        let currentLang = defaultLang;

        function t(key) {
            return translations[currentLang][key] || key;
        }

        function applyTranslations() {
            document.querySelectorAll('[data-i18n]').forEach(node => {
                const key = node.getAttribute('data-i18n');
                if (key) node.textContent = t(key);
            });
        }

        function applyTheme() {
            if (!tg || !tg.themeParams) return;
            const root = document.documentElement.style;
            const params = tg.themeParams;
            root.setProperty('--tg-bg', params.bg_color || '');
            root.setProperty('--tg-text', params.text_color || '');
            root.setProperty('--tg-hint', params.hint_color || '');
            root.setProperty('--tg-link', params.link_color || '');
            root.setProperty('--tg-button', params.button_color || '');
            root.setProperty('--tg-button-text', params.button_text_color || '');
            root.setProperty('--tg-secondary-bg', params.secondary_bg_color || '');
        }

        function setUserInfo() {
            const user = tg?.initDataUnsafe?.user;
            const userInfo = document.getElementById('userInfo');
            if (!userInfo) return;
            if (user) {
                const name = [user.first_name, user.last_name].filter(Boolean).join(' ');
                const username = user.username ? `@${user.username}` : '';
                userInfo.textContent = `${name || 'Player'} ${username}`;
            } else {
                userInfo.textContent = 'Telegram initData Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾';
            }
        }

        function activateSection(id) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.toggle('active', section.id === id);
            });
            document.querySelectorAll('.nav button').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.section === id);
            });
        }

        function sendToBot(type, payload) {
            if (!tg || typeof tg.sendData !== 'function') {
                console.warn('Telegram WebApp sendData unavailable');
                return;
            }
            tg.sendData(JSON.stringify({ type, payload, initData: tg.initData }));
        }

        function parseScore(value) {
            if (value === '' || value === null || value === undefined) return null;
            const num = Number(value);
            return Number.isFinite(num) ? num : null;
        }

        function isValidSetScore(a, b) {
            if (a === null || b === null) return false;
            if (a < 0 || b < 0 || a > 7 || b > 7) return false;
            if (a === 6 && b <= 4) return true;
            if (b === 6 && a <= 4) return true;
            if (a === 7 && (b === 5 || b === 6)) return true;
            if (b === 7 && (a === 5 || a === 6)) return true;
            return false;
        }

        function collectSetScores() {
            const sets = [1, 2, 3].map(set => {
                const a = parseScore(document.querySelector(`.set-score[data-set="${set}"][data-team="A"]`)?.value || '');
                const b = parseScore(document.querySelector(`.set-score[data-set="${set}"][data-team="B"]`)?.value || '');
                if (a === null && b === null) return null;
                return { set, a, b };
            }).filter(Boolean);
            return sets;
        }

        function validateMatch() {
            const teamA = document.getElementById('matchTeamA').value.trim();
            const teamB = document.getElementById('matchTeamB').value.trim();
            const sets = collectSetScores();
            if (!teamA || !teamB) {
                return { ok: false, message: currentLang === 'uk' ? 'Ð’ÐºÐ°Ð¶Ñ–Ñ‚ÑŒ Ð¾Ð±Ð¸Ð´Ð²Ñ– Ð¿Ð°Ñ€Ð¸.' : 'Enter both pairs.' };
            }
            if (sets.length === 0) {
                return { ok: false, message: currentLang === 'uk' ? 'Ð’ÐºÐ°Ð¶Ñ–Ñ‚ÑŒ Ñ…Ð¾Ñ‡Ð° Ð± Ð¾Ð´Ð¸Ð½ ÑÐµÑ‚.' : 'Enter at least one set.' };
            }
            const invalidSet = sets.find(set => !isValidSetScore(set.a, set.b));
            if (invalidSet) {
                return { ok: false, message: currentLang === 'uk' ? 'ÐÐµÐºÐ¾Ñ€ÐµÐºÑ‚Ð½Ð¸Ð¹ Ñ€Ð°Ñ…ÑƒÐ½Ð¾Ðº. Ð”Ð¾Ð·Ð²Ð¾Ð»ÐµÐ½Ñ– 6-0..6-4, 7-5, 7-6.' : 'Invalid score. Allowed 6-0..6-4, 7-5, 7-6.' };
            }
            return { ok: true, teamA, teamB, sets };
        }

        function runSelfTests() {
            const testCases = [
                { a: 6, b: 4, ok: true },
                { a: 4, b: 6, ok: true },
                { a: 7, b: 5, ok: true },
                { a: 5, b: 7, ok: true },
                { a: 7, b: 6, ok: true },
                { a: 6, b: 7, ok: true },
                { a: 6, b: 5, ok: false },
                { a: 5, b: 6, ok: false },
                { a: 8, b: 6, ok: false }
            ];
            const failures = testCases.filter(test => isValidSetScore(test.a, test.b) !== test.ok);
            if (failures.length > 0) {
                console.warn('Self-test failed for set validation', failures);
                return false;
            }
            console.info('Self-test passed for set validation');
            return true;
        }

        function showMatchError(message) {
            const el = document.getElementById('matchError');
            el.textContent = message;
            el.style.display = 'block';
        }

        function clearMatchError() {
            const el = document.getElementById('matchError');
            el.textContent = '';
            el.style.display = 'none';
        }

        document.querySelectorAll('.nav button').forEach(btn => {
            btn.addEventListener('click', () => activateSection(btn.dataset.section));
        });

        document.getElementById('createPairBtn').addEventListener('click', () => {
            const playerA = document.getElementById('pairPlayerA').value.trim();
            const playerB = document.getElementById('pairPlayerB').value.trim();
            if (!playerA || !playerB) return;
            sendToBot('create_pair', { playerA, playerB });
        });

        document.getElementById('submitMatchBtn').addEventListener('click', () => {
            clearMatchError();
            const result = validateMatch();
            if (!result.ok) {
                showMatchError(result.message);
                return;
            }
            sendToBot('add_match', result);
        });

        languageSelect.value = currentLang;
        languageSelect.addEventListener('change', () => {
            currentLang = languageSelect.value;
            localStorage.setItem('padel-lang', currentLang);
            applyTranslations();
        });

        if (tg) {
            tg.onEvent('themeChanged', applyTheme);
        }

        applyTheme();
        setUserInfo();
        applyTranslations();

        if (new URLSearchParams(window.location.search).get('selftest') === '1') {
            runSelfTests();
        }
    </script>
</body>
</html>
